openapi: 3.0.3
info:
  title: AXZY PARKING API
  description: API para control de estacionamiento, entradas, salidas, movimientos y evidencia.
  version: 1.0.0

servers:
  - url: http://localhost:4444/api/v1
    description: Local server

tags:
  - name: users
    description: Gestión de usuarios y roles
  - name: locations
    description: Gestión de cajones de estacionamiento
  - name: uploads
    description: Carga de archivos
  - name: kardex
    description: Registro de rondines y evidencia



paths:

  ###########################################################################
  # USERS
  ###########################################################################
  /users:
    get:
      tags: [users]
      summary: Obtener todos los usuarios
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultUserArray'

    post:
      tags: [users]
      summary: Registrar nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        "201":
          description: Usuario creado exitosamente.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultUser'

  /users/login:
    post:
      tags: [users]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLogin'
        "401":
          description: Invalid credentials

  ###########################################################################
  # LOCATIONS
  ###########################################################################
  /locations:
    get:
      tags: [locations]
      summary: Listar locaciones

      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLocationArray'
    post:
      tags: [locations]
      summary: Crear locación
      requestBody:
        required: true
        content:
          application/json:
            schema:
               type: object
               properties:
                 aisle: { type: string }
                 spot: { type: string }
                 number: { type: string }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLocation'

  ###########################################################################
  # UPLOADS
  ###########################################################################
  /uploads:
    post:
      tags: [uploads]
      summary: Subir archivo (Imagen o Video)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultUpload'

  ###########################################################################
  # KARDEX
  ###########################################################################
  /kardex:
    post:
      tags: [kardex]
      summary: Crear registro de kardex
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KardexCreate'
      responses:
        "201":
           description: Le Created
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultKardex'
    get:
      tags: [kardex]
      summary: Listar kardex (filtros opcionales)
      parameters:
        - in: query
          name: userId
          schema:
            type: integer
        - in: query
          name: locationId
          schema:
            type: integer
        - in: query
          name: startDate
          schema:
            type: string
            format: date-time
        - in: query
          name: endDate
          schema:
            type: string
            format: date-time
      responses:
         "200":
           description: OK
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultKardexArray'
  
  /kardex/{id}:
    get:
      tags: [kardex]
      summary: Detalle de kardex
      parameters:
        - in: path
          name: id
          required: true
          schema: 
            type: integer
      responses:
         "200":
           description: OK
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultKardex'




components:
  schemas:
    ################################################################
    # TResult WRAPPERS
    ################################################################
    TResultString:
      type: object
      properties:
        data: { type: string }
        error: { type: string, nullable: true }

    TResultUser:
      type: object
      properties:
        data: { $ref: '#/components/schemas/User' }
        error: { type: string, nullable: true }

    TResultUserArray:
      type: object
      properties:
        data:
          type: array
          items: { $ref: '#/components/schemas/User' }
        error: { type: string, nullable: true }

    TResultLogin:
      type: object
      properties:
        data: { type: string, description: JWT generado }
        error: { type: string, nullable: true }
    
    TResultLocation:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Location' }
         error: { type: string, nullable: true }
    
    TResultLocationArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Location' }
         error: { type: string, nullable: true }

    TResultUpload:
       type: object
       properties:
         data:
           type: object
           properties:
             url: { type: string }
             mimetype: { type: string }
             size: { type: integer }
         error: { type: string, nullable: true }

    TResultKardex:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Kardex' }
         error: { type: string, nullable: true }

    TResultKardexArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Kardex' }
         error: { type: string, nullable: true }



    ################################################################
    # ENTITIES
    ################################################################

    User:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        lastName: { type: string }
        username: { type: string }

        role: 
           type: string
           enum: [ADMIN, SHIFT_GUARD, GUARD]
    UserCreate:
      type: object
      required: [name, username, password]

      properties:
        name: { type: string }
        lastName: { type: string }
        username: { type: string }

        password: { type: string }
        role: 
           type: string
           enum: [ADMIN, SHIFT_GUARD, GUARD]
    UserLogin:
      type: object
      required: [username, password]

      properties:
        username: { type: string }

        password: { type: string }
    
    Location:
       type: object
       properties:
         id: { type: integer }
         name: { type: string }
         aisle: { type: string }
         spot: { type: string }
         number: { type: string }
         isOccupied: { type: boolean }
    
    Kardex:
       type: object
       properties:
         id: { type: integer }
         userId: { type: integer }
         locationId: { type: integer }
         timestamp: { type: string, format: date-time }
         notes: { type: string }
         media: 
           type: array
           items:
             type: object
             properties:
               type: { type: string, enum: [IMAGE, VIDEO] }
               url: { type: string }
               description: { type: string }
         user: { $ref: '#/components/schemas/User' }
         location: { $ref: '#/components/schemas/Location' }
    
    KardexCreate:
       type: object
       required: [userId, locationId]
       properties:
         userId: { type: integer }
         locationId: { type: integer }
         notes: { type: string }
         media:
           type: array
           items:
             type: object
             properties:
               type: { type: string, enum: [IMAGE, VIDEO] }
               url: { type: string }
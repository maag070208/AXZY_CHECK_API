openapi: 3.0.3
info:
  title: AXZY PARKING API
  description: API para control de estacionamiento, entradas, salidas, movimientos y evidencia.
  version: 1.0.0

servers:
  - url: http://localhost:4444/api/v1
    description: Local server

tags:
  - name: users
    description: Gestión de usuarios y roles
  - name: locations
    description: Gestión de cajones de estacionamiento
  - name: entries
    description: Registro de entradas y evidencia fotográfica
  - name: movements
    description: Movimientos de vehículos
  - name: exits
    description: Registro de salidas

paths:

  ###########################################################################
  # USERS
  ###########################################################################
  /users:
    get:
      tags: [users]
      summary: Obtener todos los usuarios
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultUserArray'

    post:
      tags: [users]
      summary: Registrar nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        "201":
          description: Usuario creado exitosamente.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultUser'

  /users/login:
    post:
      tags: [users]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLogin'
        "401":
          description: Invalid credentials

  ###########################################################################
  # LOCATIONS
  ###########################################################################
  /locations:
    get:
      tags: [locations]
      summary: Listar locaciones
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLocationArray'
    post:
      tags: [locations]
      summary: Crear locación
      requestBody:
        required: true
        content:
          application/json:
            schema:
               type: object
               properties:
                 aisle: { type: string }
                 spot: { type: string }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultLocation'

  ###########################################################################
  # ENTRIES
  ###########################################################################
  /entries:
    get:
      tags: [entries]
      summary: Listar entradas
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultEntryArray'
    post:
      tags: [entries]
      summary: Registrar entrada (Fotos)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                userId: { type: integer }
                operatorUserId: { type: integer }
                brand: { type: string }
                model: { type: string }
                color: { type: string }
                plates: { type: string }
                mileage: { type: integer }
                notes: { type: string }
                photo_frontal: { type: string, format: binary }
                photo_trasera: { type: string, format: binary }
                photo_lateral_derecho: { type: string, format: binary }
                photo_lateral_izquierdo: { type: string, format: binary }
                photo_interior: { type: string, format: binary }
                photo_extras: { type: string, format: binary }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultEntry'

  /entries/{id}:
    get:
      tags: [entries]
      summary: Detalle entrada
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TResultEntry'

  ###########################################################################
  # MOVEMENTS
  ###########################################################################
  /movements:
    get:
      tags: [movements]
      summary: Listar movimientos
      responses:
         "200":
           description: OK
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultMovementArray'
    post:
      tags: [movements]
      summary: Registrar movimiento
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                entryId: { type: integer }
                toLocationId: { type: integer }
                assignedUserId: { type: integer }
      responses:
        "201":
           description: Created
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultMovement'

  ###########################################################################
  # EXITS
  ###########################################################################
  /exits:
    get:
      tags: [exits]
      summary: Listar salidas
      responses:
         "200":
           description: OK
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/TResultExitArray'
    post:
      tags: [exits]
      summary: Registrar salida
      requestBody:
        content:
          application/json:
             schema:
               type: object
               properties:
                 entryId: { type: integer }
                 operatorUserId: { type: integer }
                 notes: { type: string }
      responses:
         "201":
            description: Created
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/TResultExit'

components:
  schemas:
    ################################################################
    # TResult WRAPPERS
    ################################################################
    TResultString:
      type: object
      properties:
        data: { type: string }
        error: { type: string, nullable: true }

    TResultUser:
      type: object
      properties:
        data: { $ref: '#/components/schemas/User' }
        error: { type: string, nullable: true }

    TResultUserArray:
      type: object
      properties:
        data:
          type: array
          items: { $ref: '#/components/schemas/User' }
        error: { type: string, nullable: true }

    TResultLogin:
      type: object
      properties:
        data: { type: string, description: JWT generado }
        error: { type: string, nullable: true }
    
    TResultLocation:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Location' }
         error: { type: string, nullable: true }
    
    TResultLocationArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Location' }
         error: { type: string, nullable: true }

    TResultEntry:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Entry' }
         error: { type: string, nullable: true }
    
    TResultEntryArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Entry' }
         error: { type: string, nullable: true }

    TResultMovement:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Movement' }
         error: { type: string, nullable: true }
    
    TResultMovementArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Movement' }
         error: { type: string, nullable: true }

    TResultExit:
       type: object
       properties:
         data: { $ref: '#/components/schemas/Exit' }
         error: { type: string, nullable: true }
    
    TResultExitArray:
       type: object
       properties:
         data:
           type: array
           items: { $ref: '#/components/schemas/Exit' }
         error: { type: string, nullable: true }

    ################################################################
    # ENTITIES
    ################################################################

    User:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        lastName: { type: string }
        email: { type: string }
        role: { type: string }

    UserCreate:
      type: object
      required: [name, email, password]
      properties:
        name: { type: string }
        lastName: { type: string }
        email: { type: string }
        password: { type: string }
        role: { type: string }

    UserLogin:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }
    
    Location:
       type: object
       properties:
         id: { type: integer }
         name: { type: string }
         aisle: { type: string }
         spot: { type: string }
         isOccupied: { type: boolean }
    
    Entry:
       type: object
       properties:
         id: { type: integer }
         entryNumber: { type: string }
         plates: { type: string }
         brand: { type: string }
         model: { type: string }
         color: { type: string }
         status: { type: string }
         photos: 
           type: array
           items: 
             type: object
             properties:
               category: { type: string }
               imageUrl: { type: string }
    
    Movement:
       type: object
       properties:
         id: { type: integer }
         fromLocationId: { type: integer }
         toLocationId: { type: integer }
    
    Exit:
       type: object
       properties:
         id: { type: integer }
         exitDate: { type: string }